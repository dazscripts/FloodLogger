local WebhookColor = 0x8800ff

_G.HttpService = game:GetService("HttpService")
_G.Players = game:GetService("Players")
_G.ReplicatedStorage = game:GetService("ReplicatedStorage")
_G.Workspace = game:GetService('Workspace')

_G.plr = Players.LocalPlayer

_G.Amounts_Path = plr.PlayerGui.MenuGui.Goals.Window.Content.Pages.LastGame.RewardBar.Content
_G.GEM_PATH = Amounts_Path.GemAward.Amount
_G.COIN_PATH = Amounts_Path.CoinAward.Amount
_G.XP_PATH = plr.PlayerGui.MenuGui.Goals.Window.Content.Pages.LastGame.RewardBar.XpAmount
_G.ESCAPED_PATH = Amounts_Path.MapsEscaped.Amount

_G.GEMS = 0
_G.COINS = 0
_G.XP = 0
_G.ESCAPED = 0

_G.Door = game.Workspace.Lobby.PlayHere

loadstring(game:HttpGet("https://raw.githubusercontent.com/dazscripts/FloodLogger/main/functions/HTTP"))()

local function SendHttpsStats()
    GEMS += tonumber(GEM_PATH.Text)
    COINS += tonumber(COIN_PATH.Text)
    XP += string.gsub(XP_PATH.Text, "XP", "", 1)
    ESCAPED += tonumber(ESCAPED_PATH.Text)

    DeathMessage()
end

plr.CharacterAdded:Connect(function(char)
    task.wait(3)
	local path = PS:CreatePath()
	local p = path:ComputeAsync(char.HumanoidRootPart.Position, Door.Position)
	local waypoints = path:GetWaypoints()
	for i, v in ipairs(waypoints) do
		char.Humanoid:MoveTo(v.Position)
		char.Humanoid.MoveToFinished:Wait()
	end
	char.HumanoidRootPart.CFrame = Door.CFrame * CFrame.new(0,0,2)
    SendHttpsStats()
end)

loadstring(game:HttpGetAsync"https://raw.githubusercontent.com/ImMejor35/Flood-GUI/main/loader.lua")"main"

local FoundEscapee = false
local FoundPage = false

local function FindCollectibles(map)
    map.ChildAdded:Connect(function(child)
        if child.Name == "_Rescue" then
            FoundEscapee = true
            task.wait(6.5)

            firetouchinterest(plr.Character.PrimaryPart, child.Contact, 0)
            task.wait(0.2)
            firetouchinterest(plr.Character.PrimaryPart, child.Contact, 1)
            
            EscapeeNotif()
        elseif child.Name == "_LostPage" then
            FoundPage = true 
            task.wait(6.5)

            firetouchinterest(plr.Character.PrimaryPart, child, 0)
            task.wait(0.2)
            firetouchinterest(plr.Character.PrimaryPart, child, 1)
            
            LostPageNotif()
        end
    end)
end

local function SendNewMapInfo(map)
    coroutine.wrap(FindCollectibles)(map)
    _G.Settings = Workspace.Multiplayer.Map.Settings
    local MapName = Settings.MapName.Value
    _G.Mirrored = false
    local FindMirrorObject = Settings:FindFirstChild("_MirrorMap")

    if not FindMirrorObject then Mirrored = true end

    task.wait(1)

    MapNotif()

    task.wait(1)

    FoundEscapee, FoundPage = false,false
end


plr.PlayerScripts.Misc.CL_WaterColors.InitMap.Event:Connect(SendNewMapInfo)
